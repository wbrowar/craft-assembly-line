# Assembly Line
Testing and front-end build tools for Craft CMS plugins generated by https://pluginfactory.io.


## Overview
Assembly Line provides an opinionated framework to test and build Craft CMS plugins. It uses [DDEV-Local](https://ddev.readthedocs.io/en/stable/) as a Docker-based local Craft CMS install where your plugin code can be tested. For plugins that need CSS and JS, Vite and Vue 3 are included to bundle front-end assets.

While Assembly Line can be used with any Craft CMS plugin, its default configuration is set up for plugins generated by [Plugin Factory](https://pluginfactory.io).


## Requirments
- [DDEV-Local](https://ddev.readthedocs.io/en/stable/#installation) installed. This requires Homebrew and Docker Desktop, too.

_NOTE: this is tested to work on macOS 11+. There is currently no support for Windows or Linux._


## Installation
1. Clone this repo to your local machine.
1. Copy the following files and directories into your plugin directory:
   - .ddev
   - _source
   - package.json
   - tsconfig.json
1. The .gitignore file in this directory has some basic defaults for most Craft CMS plugin repos along with settings to ignore Assembly Line files. You can replace your plugin’s .gitignore or manually merge them together into your plugin repo’s root directory.


## Setting up DDEV
Before starting DDEV, some files need to be configured by finding and replacing values THAT_LOOK_LIKE_THIS with configuration specific to your plugin. The setup script that executes when you start DDEV will do some simple checks to make sure these replacements have been made, and from there you can make adjustments to each config file as you'd prefer (for example, setting your preferred docker image or PHP version.).

Here are the replacements that need to happen before working with DDEV:

- Replace REPLACE_WITH_NAME in ./.ddev/config.yaml with a unique name.
- Replace REPLACE_WITH_SITE_URL in ./.ddev/config.yaml with a local testing domain. For example setting this to my-project.test lets you visit this Craft site at https://my-project.test/
- Replace REPLACE_WITH_PACKAGE_NAME in ./.ddev/setup.sh with your plugin package name.
- Replace REPLACE_WITH_SITE_URL in ./.ddev/setup.sh with the same value set for REPLACE_WITH_SITE_URL.test in ./.ddev/config.yaml.
- Replace REPLACE_WITH_SITE_URL in _source/_craft/example.env with a local testing domain. For example setting this to my-project.test lets you visit this Craft site at https://my-project.test/
- Replace REPLACE_WITH_PACKAGE_NAME in _source/_craft/composer.json with your plugin package name (vendor/name).


## DDEV Commands
Any [DDEV CLI command](https://ddev.readthedocs.io/en/stable/users/cli-usage/) will work. Here are common commands along with a few custom helper commands:

| Command | Notes |
| --- | --- |
| `ddev start` | Starts or restarts the Docker container and runs the setup script at ./.ddev/setup.sh. If needed, composer install will run and Craft CMS will be set up in the DDEV database. |
| `ddev import-db --src=PATH_TO_SQL_FILE` | Import MySQL-based tables into the container’s default database. After the database is imported, ./.ddev/setup.sh is run to perform Craft’s CLI commands to `migrate/all`, `project-config/apply`, and `cache/flush-all`. |
| `ddev clean-craft` | Wipes out the `vendor` directory, the `composer.lock` file, and some Craft `storage` directories. This command never really needs to be run, but it is safe to run if you want to clear out Craft and re-run `ddev start` for a clean composer install. _NOTE: it doesn’t interact wth the database so Craft will remain installed in the database unless you manually drop tables or nuke everything with `ddev delete`. |


## Credits
The DDEV setup was inspired by work by Zach Sackett and Marc Hartwig.